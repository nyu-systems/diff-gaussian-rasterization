import torch
from torch.optim import Adam
from torch.nn.parameter import Parameter

torch.set_printoptions(precision=8)
x = torch.tensor([[-0.27592263,  1.45741498, -0.27912900,  0.50304019,  0.86184853,
         -0.32407281, -1.52546418, -1.96944582, -0.53279704, -0.41407126],
        [-0.95485938,  1.15692687,  0.12052462,  1.02900600,  1.84076631,
         -1.68385124, -0.33590776,  1.00695574,  1.03142250, -1.00076318],
        [ 1.81195509, -0.22080292,  0.11890169, -0.65061569, -0.81037229,
          0.54507124,  0.81413180,  1.09742665,  1.57154584,  0.57803059]])

x = Parameter(x, requires_grad=True)
optimizer = Adam([x], lr=0.001) # lr=0.001, betas=(0.9, 0.999), eps = 1e-08, lambda=0

x_grads = torch.tensor([[[ 0.07473613,  1.56163168,  0.28564924,  0.01889815, -0.54510576,
           0.85064983, -0.56617403, -0.07482366,  0.02878939,  1.54267907],
         [ 0.58476758,  0.26001054,  1.92268038,  1.12250161,  0.60945231,
          -0.70252180,  0.11896414,  2.62669826,  1.14733517,  1.32487988],
         [-0.81552619,  0.99882501, -0.64356738, -0.04739735,  1.46378231,
           0.24348104, -2.88094211, -0.91592652, -2.29048586, -1.01007438]],

        [[-0.98535091, -1.73668420, -0.05086657, -1.44171917,  0.43991885,
           0.65620345,  0.44912094, -0.14710099, -0.21040316, -0.40319443],
         [-0.06958726,  0.43770602,  0.07748552,  1.24373889,  0.14032423,
           1.00267744,  1.72498930,  0.59682721,  0.26976928, -0.54612094],
         [-0.34102049, -0.59851044,  1.13875771,  1.05349743,  1.95135224,
           0.69864887,  0.38912052, -1.05770671,  0.29336196, -2.67789888]],

        [[ 1.37632000, -0.18108919, -0.01681380, -0.75458151,  1.11079967,
          -1.44590819,  0.17561451,  0.99313498,  0.01364532, -0.68604785],
         [ 0.76482975,  0.09839045,  1.56569505,  0.33089188,  1.01337695,
           0.70193583, -1.60114908, -0.51892471,  0.10334733, -1.26984406],
         [ 0.69558650, -0.54795384, -0.14722003, -0.17217109, -1.24127150,
          -0.62672704, -0.76675224,  1.17779899, -0.91626447, -0.13996741]]])

for i in range(3):
  optimizer.zero_grad()
  x.grad = x_grads[i]
  optimizer.step()
  print(optimizer.state)

  # print(x)



''' Test cases
x = torch.tensor(
  [[ 1.8649, -0.9866, -0.7126, -0.6548, -0.7185,  1.8079, -0.9726, -0.7098, 0.1941,  0.7133],
   [-1.1391, -0.6703,  1.5527,  0.4489, -0.1118,  0.3704, -1.3762,  0.8194, 1.4620,  1.1628],
   [ 0.5545,  0.5393,  0.0953, -0.8078,  0.2225,  0.2471,  2.3399,  1.8631, 0.4424,  0.0397]])

x = Parameter(x, requires_grad=True)
optimizer = Adam([x]) # lr=0.001, betas=(0.9, 0.999), eps = 1e-08, lambda=0

x_grads = torch.tensor(
  [[[ 1.2133,  0.3023,  0.6451, -0.9206,  0.5512,  0.0706, -1.0904,  0.2389, -0.0583, -0.1151],
    [ 2.9081,  0.1069,  0.3370, -0.5074,  0.0639,  0.5355, -0.9631,  0.4505, 1.4487,  0.4975],
    [ 0.6559,  0.6788,  0.2692, -0.5634,  0.7778,  2.2166,  0.7250, -1.6614, -0.3858, -0.2762]],
   [[ 0.1576, -0.8068,  0.2293,  0.6080,  0.1964,  0.5314,  0.3944,  0.8259, 1.7691,  0.1292],
    [ 0.5342, -0.6874, -1.1333, -1.0149, -0.2244, -0.9969,  0.6257, -1.6009, 0.1704,  0.7526],
    [ 1.7362, -1.3536, -0.6049, -0.5846,  0.1840, -0.5483, -1.2069, -1.4915, 0.2540, -0.5554]],
   [[-1.5763,  1.1094,  0.9342,  0.4130, -0.9063, -0.5036,  0.9408, -1.3387, 1.6467,  0.6181],
    [-0.4113,  0.2346,  0.8250,  0.5649,  0.4157, -2.0963,  0.5174,  1.6296, 1.0475, -0.7006],
    [-0.3398, -1.3262,  0.4638,  0.6425, -0.4382,  0.3420,  0.4193,  0.2678, 1.4178, -0.3594]]]
)

for i in range(3):
  optimizer.zero_grad()
  x.grad = x_grads[i]
  optimizer.step()

  print(x)

Parameter containing:
tensor([[ 1.8639, -0.9876, -0.7136, -0.6538, -0.7195,  1.8069, -0.9716, -0.7108, 0.1951,  0.7143],
        [-1.1401, -0.6713,  1.5517,  0.4499, -0.1128,  0.3694, -1.3752,  0.8184, 1.4610,  1.1618],
        [ 0.5535,  0.5383,  0.0943, -0.8068,  0.2215,  0.2461,  2.3389,  1.8641, 0.4434,  0.0407]], requires_grad=True)
Parameter containing:
tensor([[ 1.8631, -0.9871, -0.7145, -0.6537, -0.7204,  1.8061, -0.9712, -0.7117, 0.1944,  0.7142],
        [-1.1409, -0.6707,  1.5522,  0.4509, -0.1123,  0.3697, -1.3750,  0.8189, 1.4602,  1.1608],
        [ 0.5526,  0.5387,  0.0947, -0.8058,  0.2207,  0.2456,  2.3392,  1.8651, 0.4436,  0.0417]], requires_grad=True)
Parameter containing:
tensor([[ 1.8633, -0.9874, -0.7154, -0.6538, -0.7202,  1.8060, -0.9714, -0.7115, 0.1935,  0.7136],
        [-1.1414, -0.6704,  1.5522,  0.4512, -0.1126,  0.3704, -1.3752,  0.8188, 1.4594,  1.1606],
        [ 0.5520,  0.5393,  0.0946, -0.8056,  0.2204,  0.2452,  2.3392,  1.8658, 0.4430,  0.0426]], requires_grad=True)

'''

